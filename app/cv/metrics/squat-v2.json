{
  "exercise_name": "squat",
  "version": "2.0",
  "description": "Squat exercise with semantic error taxonomy for 3D pose analysis",
  
  "landmark_features": {
    "dominant_side_detection": {
      "points": ["knee", "knee"],
      "method": "y_position_comparison"
    },
    "required_landmarks": {
      "left": ["hip", "knee", "ankle"],
      "right": ["hip", "knee", "ankle"],
      "center": ["nose", "shoulder"]
    }
  },
  
  "angle_definitions": [
    {
      "name": "knee_angle",
      "description": "Primary angle for squat depth tracking",
      "calculation": {
        "point1": "hip",
        "point2": "ankle", 
        "ref_point": "knee",
        "type": "standard"
      },
      "semantic_importance": "primary"
    },
    {
      "name": "hip_angle",
      "description": "Hip flexion angle for movement pattern analysis",
      "calculation": {
        "point1": "shoulder",
        "point2": "knee",
        "ref_point": "hip",
        "type": "standard"
      },
      "semantic_importance": "secondary"
    },
    {
      "name": "back_angle",
      "description": "Torso angle for posture monitoring",
      "calculation": {
        "point1": "shoulder",
        "point2": "hip",
        "type": "vertical",
        "direction": "down"
      },
      "semantic_importance": "form_critical"
    }
  ],
  
  "finite_state_machine": {
    "beginner": {
      "states": [
        {
          "id": "s1",
          "name": "standing_position",
          "description": "Starting/ending position standing upright",
          "condition": "knee_angle > 160",
          "exercise_phase": "rest",
          "coaching_focus": "preparation"
        },
        {
          "id": "s2", 
          "name": "descending_phase",
          "description": "Lowering down into squat position",
          "condition": "knee_angle <= 160 and knee_angle > 90",
          "exercise_phase": "eccentric",
          "coaching_focus": "control"
        },
        {
          "id": "s3",
          "name": "bottom_position", 
          "description": "Deep squat position",
          "condition": "knee_angle <= 90",
          "exercise_phase": "isometric",
          "coaching_focus": "depth"
        }
      ],
      "success_sequence": ["s1", "s2", "s3", "s2", "s1"],
      "transition_rules": {
        "valid_transitions": {
          "s1": ["s2"],
          "s2": ["s3", "s1"],
          "s3": ["s2"]
        },
        "invalid_penalty": "form_deviation"
      }
    },
    "pro": {
      "states": [
        {
          "id": "s1",
          "name": "standing_position",
          "description": "Starting position with perfect posture",
          "condition": "knee_angle > 170",
          "exercise_phase": "rest",
          "coaching_focus": "precision"
        },
        {
          "id": "s2",
          "name": "controlled_descent",
          "description": "Controlled lowering with strict form",
          "condition": "knee_angle <= 170 and knee_angle > 80",
          "exercise_phase": "eccentric",
          "coaching_focus": "tempo_control"
        },
        {
          "id": "s3",
          "name": "deep_squat",
          "description": "Full depth squat with optimal hip mobility",
          "condition": "knee_angle <= 80",
          "exercise_phase": "isometric", 
          "coaching_focus": "mobility_strength"
        }
      ],
      "success_sequence": ["s1", "s2", "s3", "s2", "s1"]
    }
  },
  
  "error_taxonomy": {
    "safety_violations": {
      "knee_valgus": {
        "code_prefix": "SAFETY_KNEE_VALGUS",
        "description": "Dangerous inward knee collapse that could cause injury",
        "states_applicable": ["s2", "s3"],
        "immediate_intervention": true,
        "coaching_priority": "critical",
        "semantic_category": "safety_concern",
        "detection": {
          "angle": "knee_angle",
          "threshold_type": "range_safety",
          "safe_range": [60, 180],
          "severity_levels": {
            "critical": {"range": [0, 45], "priority": "immediate"},
            "major": {"range": [45, 60], "priority": "high"}
          }
        }
      },
      "excessive_forward_lean": {
        "code_prefix": "SAFETY_FORWARD_LEAN",
        "description": "Dangerous forward lean that could stress lower back",
        "states_applicable": ["s2", "s3"],
        "immediate_intervention": true,
        "coaching_priority": "critical",
        "semantic_category": "safety_concern",
        "detection": {
          "angle": "back_angle",
          "threshold_type": "range_safety",
          "safe_range": [10, 45],
          "severity_levels": {
            "critical": {"range": [0, 5], "priority": "immediate"},
            "major": {"range": [45, 70], "priority": "high"}
          }
        }
      }
    },
    
    "technique_violations": {
      "insufficient_depth": {
        "code_prefix": "TECHNIQUE_DEPTH",
        "description": "Not reaching proper squat depth for full range of motion",
        "states_applicable": ["s3"],
        "coaching_priority": "high",
        "semantic_category": "technical_issue",
        "detection": {
          "angle": "knee_angle",
          "threshold_type": "deviation_from_target",
          "target_angle": 85,
          "severity_levels": {
            "minor": {"threshold": 10, "priority": "medium", "code_suffix": "MINOR_SHALLOW"},
            "major": {"threshold": 25, "priority": "high", "code_suffix": "MAJOR_SHALLOW"}
          }
        }
      },
      "hip_mobility_limitation": {
        "code_prefix": "TECHNIQUE_HIP_MOBILITY",
        "description": "Limited hip flexion affecting squat mechanics",
        "states_applicable": ["s2", "s3"],
        "coaching_priority": "medium",
        "semantic_category": "technical_issue",
        "state_specific_detection": {
          "s2": {
            "angle": "hip_angle",
            "description": "Hip angle should increase during descent",
            "optimal_range": [90, 130],
            "severity_levels": {
              "minor": {"range": [80, 140], "priority": "medium", "code_suffix": "MINOR_RESTRICTION"},
              "major": {"range": [60, 160], "priority": "high", "code_suffix": "MAJOR_RESTRICTION"}
            }
          },
          "s3": {
            "angle": "hip_angle",
            "description": "Deep hip flexion required at bottom position",
            "optimal_range": [120, 150],
            "severity_levels": {
              "minor": {"range": [110, 160], "priority": "medium", "code_suffix": "MINOR_RESTRICTION"},
              "major": {"range": [90, 180], "priority": "high", "code_suffix": "MAJOR_RESTRICTION"}
            }
          }
        }
      }
    },
    
    "form_violations": {
      "knee_tracking": {
        "code_prefix": "FORM_KNEE_TRACKING",
        "description": "Knees not tracking properly over toes",
        "states_applicable": ["s2", "s3"],
        "coaching_priority": "medium",
        "semantic_category": "form_deviation",
        "detection": {
          "angle": "knee_angle",
          "description": "Knees should maintain proper alignment throughout movement",
          "state_specific_thresholds": {
            "s2": {
              "optimal_range": [120, 160],
              "severity_levels": {
                "minor": {"range": [110, 170], "priority": "low"},
                "major": {"range": [90, 180], "priority": "medium"}
              }
            },
            "s3": {
              "optimal_range": [70, 90],
              "severity_levels": {
                "minor": {"range": [60, 100], "priority": "low"},
                "major": {"range": [45, 120], "priority": "medium"}
              }
            }
          }
        }
      },
      "posture_control": {
        "code_prefix": "FORM_POSTURE",
        "description": "Maintaining upright torso throughout movement",
        "states_applicable": ["s2", "s3"],
        "coaching_priority": "medium",
        "semantic_category": "form_deviation",
        "detection": {
          "angle": "back_angle",
          "description": "Torso should stay relatively upright",
          "state_specific_thresholds": {
            "s2": {
              "optimal_range": [15, 35],
              "severity_levels": {
                "minor": {"range": [10, 45], "priority": "low"},
                "major": {"range": [5, 60], "priority": "medium"}
              }
            },
            "s3": {
              "optimal_range": [20, 40],
              "severity_levels": {
                "minor": {"range": [15, 50], "priority": "low"},
                "major": {"range": [10, 65], "priority": "medium"}
              }
            }
          }
        }
      }
    },
    
    "execution_issues": {
      "tempo_control": {
        "code_prefix": "EXECUTION_TEMPO",
        "description": "Movement speed and control issues",
        "states_applicable": ["s2", "s3"],
        "coaching_priority": "low",
        "semantic_category": "execution_problem",
        "detection": {
          "method": "state_duration_analysis",
          "optimal_durations": {
            "s2": {"min": 1.5, "max": 4.0},
            "s3": {"min": 0.5, "max": 2.0}
          },
          "severity_levels": {
            "too_fast": {"priority": "medium", "code_suffix": "TOO_RAPID"},
            "too_slow": {"priority": "low", "code_suffix": "TOO_SLOW"}
          }
        }
      },
      "state_stagnation": {
        "code_prefix": "EXECUTION_STAGNATION",
        "description": "Lack of progression through movement phases",
        "states_applicable": ["all"],
        "coaching_priority": "low",
        "semantic_category": "execution_problem",
        "detection": {
          "method": "temporal_analysis",
          "max_duration_per_state": {
            "s1": 10.0,
            "s2": 6.0,
            "s3": 4.0
          },
          "severity_levels": {
            "prolonged": {"priority": "low", "code_suffix": "PROLONGED"},
            "excessive": {"priority": "medium", "code_suffix": "EXCESSIVE"}
          }
        }
      }
    }
  },
  
  "coaching_configuration": {
    "feedback_intervals": {
      "immediate_attention": 0,
      "high_priority": 2,
      "medium_priority": 4,
      "low_priority": 6
    },
    
    "semantic_mapping": {
      "safety_concern": {
        "urgency": "immediate",
        "intervention_type": "stop_and_correct",
        "llm_context": "injury_prevention"
      },
      "technical_issue": {
        "urgency": "high",
        "intervention_type": "technique_guidance",
        "llm_context": "movement_mechanics"
      },
      "form_deviation": {
        "urgency": "medium",
        "intervention_type": "form_correction",
        "llm_context": "alignment_quality"
      },
      "execution_problem": {
        "urgency": "low",
        "intervention_type": "motivation_guidance",
        "llm_context": "performance_optimization"
      }
    },
    
    "progressive_complexity": {
      "beginner": {
        "focus_areas": ["safety", "basic_depth", "posture"],
        "tolerance_multiplier": 1.3
      },
      "pro": {
        "focus_areas": ["precision", "mobility", "tempo", "optimization"],
        "tolerance_multiplier": 0.7
      }
    }
  },
  
  "metadata": {
    "created_date": "2024-01-09",
    "last_modified": "2024-01-09",
    "version_notes": "Initial squat configuration with 3D pose analysis",
    "validation_schema": "exercise_config_v2",
    "compatibility": {
      "min_processor_version": "2.0",
      "supported_models": ["contextual_quality_processor"]
    }
  }
}